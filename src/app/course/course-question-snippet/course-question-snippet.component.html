<!--this overarching *ngIf is simply to avoid errors when the page tries to load before the API response is received-->
<ng-container *ngIf="uqjs">
    <div [class.container]="eventId">
        <h2 *ngIf="eventId" class="mb-3 mt-5">{{ event.name }} Questions</h2>
        <table class="table table-hover mt-3" data-toggle="table">
            <thead class="thead-light text-dark">
            <tr>
                <th scope="col">Category</th>
                <th scope="col">Sub&nbsp;Category</th>
                <th scope="col">Format</th>
                <th scope="col">Tokens Earned</th>
                <th scope="col">Status</th>
                <ng-container *ngIf="eventId">
                    <th scope="col">Num&nbsp;Attempts</th>
                </ng-container>
                <th scope="col">Action</th>
            </tr>
            </thead>
            <tbody>
            <ng-container *ngIf="uqjs.length; else tableEmpty">
                <ng-container *ngFor="let uqj of uqjs; index as i">
                    <tr [attr.class]=highlight(getStatus(uqj))>
                        <td>{{ uqj.question.parent_category_name || 'No Category' }}</td>
                        <td>{{ uqj.question.category_name || 'No Sub-Category'}}</td>
                        <td>{{ uqj.question.type_name || 'No Type'}}</td>
                        <td>{{ uqj.formatted_current_tokens_received || 'No Tokens' }}</td>
                        <td>{{ getStatus(uqj) || 'No Status'}}</td>
                        <ng-container *ngIf="eventId">
                            <td>
                                {{uqj.num_attempts}} / {{ uqj.question.max_submission_allowed}}
                            </td>
                        </ng-container>
                        <td>
                            <ng-container *ngIf="eventId; else noEvent">
                                <a class="btn btn-primary mr-3"
                                   [routerLink]="['/course', courseId, 'event', this.eventId, 'problem', uqj.question.id]">Open</a>
                            </ng-container>
                            <ng-template #noEvent>
                                <a class="btn btn-primary mr-3"
                                   [routerLink]="['/course', courseId, 'problem', uqj.question.id]">Open</a>
                            </ng-template>
                            <ng-container *ngIf="user.is_teacher">
                                <!--TODO: Edit and view have radically different routes? Is this ok?-->
                                <a class="btn btn-warning mr-3"
                                   [routerLink]="['/problem', uqj.question.id,'edit']">Edit</a>
                            </ng-container>
                            <ng-container *ngIf = "true">
                                <button type="button" mat-icon-button
                                        (click)="reportStatus(reportModal,uqj)">
                                    <mat-icon>outlined_flag</mat-icon>
                                </button>
                            </ng-container>
                            <ng-container *ngIf = "false">
                                <button type="button" mat-icon-button
                                        (click)="reportStatus(reportModal,uqj)">
                                    <mat-icon>flag</mat-icon>
                                </button>
                            </ng-container>
                        </td>
                    </tr>
                </ng-container>
            </ng-container>
            <ng-template #reportModal let-modal>
                <div class="modal-header">
                    <h4 class="modal-title" id="modal-basic-title">Report Question</h4>
                    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <form [formGroup]="formGroup" (ngSubmit)="reportQuestion()">
                <div class="modal-body">

                        <div class="form-group">
                            <label for="description">Report Reason:</label>
                            <select class="form-control" name="description" formControlName="description" id="description">
                                <option value="TYPO_TEXT">There is a typo in the question instructions</option>
                                <option value="TYPO_ANSWER">There is a typo in one of the multiple-choice answers</option>
                                <option value="RIGHT_SOLUTION_MARKED_WRONG">My solution is definitely correct but it did not get full marks</option>
                                <option value="WRONG_SOLUTION_MARKED_RIGHT">My solution is incorrect but it received full marks</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <textarea class="form-control" name="description_text" formControlName="description_text" id="description_text"></textarea>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" (click)="modal.dismiss()">Cancel</button>
                    <button type="submit" class="btn btn-outline-success" (click)="modal.close('Save click')">
                        Report
                    </button>
                </div>
                </form>
            </ng-template>

            <ng-template #tableEmpty>
                <tr>
                    <td [attr.colspan]="eventId ? 7 : 6" class="bg-info">
                        <p *ngIf="eventId; else inCourse" class="text-center text-light m-0">
                            There aren't currently any questions in this event.
                        </p>
                        <ng-template #inCourse>
                            <p class="text-center text-light m-0">
                                There aren't currently any questions in this course.
                            </p>
                        </ng-template>
                    </td>
                </tr>
            </ng-template>
            </tbody>
        </table>
    </div>
</ng-container>
